(function(e){function t(t){for(var r,o,c=t[0],s=t[1],u=t[2],f=0,h=[];f<c.length;f++)o=c[f],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(h.length)h.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==i[s]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={app:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0324":function(e,t,n){"use strict";var r=n("6683"),i=n.n(r);i.a},"5c0b":function(e,t,n){"use strict";var r=n("7694"),i=n.n(r);i.a},6683:function(e,t,n){},7694:function(e,t,n){},"97c8":function(e,t,n){},aa03:function(e,t,n){"use strict";var r=n("97c8"),i=n.n(r);i.a},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("db4d");var r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("div",{staticClass:"d-flex align-center"},[n("h1",[e._v("Turni Lavorativi")])])]),n("error-dialog"),n("loader-dialog"),n("v-content",[n("v-row",{attrs:{justify:"space-between"}},[n("MonthPicker",{attrs:{initialValue:e.context.from},on:{"update-date":e.handleUpdateDate}}),n("WorkShiftActions",{on:{"update-validation":e.handleValidation,"export-json":e.handleExportJson,"import-json":e.handleImportJson,"export-excel":e.handleExportExcel,"clear-data":e.handleClearData,optimize:e.handleOptimize}})],1),n("v-row",[n("WorkShiftTable",{attrs:{context:e.context,inlineValidation:e.inlineValidation},on:{"update-shift":function(t,n,r){return e.handleShift(t,n,r)}}})],1)],1)],1)},a=[],o=(n("99af"),n("4160"),n("d81d"),n("b0c0"),n("159b"),n("d4ec")),c=n("bee2"),s=n("262e"),u=n("2caf"),l=n("9ab4"),f=n("60a3"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{attrs:{fluid:""}},[n("v-row",[n("v-simple-table",{staticClass:"single-line",attrs:{dense:""},scopedSlots:e._u([{key:"default",fn:function(){return[n("thead",[n("tr",[n("th",{staticClass:"text-left start-of-group end-of-week",attrs:{colspan:"2"}},[e._v(" Name ")]),e._l(e.days(),(function(t){return n("th",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0,"start-of-group":!0}},[e._v(" "+e._s(e.formatHeaderDate(e.day(t)))+" ")])}))],2),n("tr",[n("th",{staticClass:"text-left"}),n("th",{staticClass:"text-left end-of-week"}),e._l(e.days(),(function(t){return n("th",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0}},[e._v(" "+e._s(e.getDayOfWeekLabel(e.day(t)))+" ")])}))],2)]),n("tbody",[e._l(e.tableElements(),(function(t){return n("tr",{key:t.id+t.type},[t.isGroup()?n("td",{staticClass:"start-of-group end-of-week table-element-name-1",attrs:{colspan:"2"}},[e._v(" "+e._s(e.getGroupName(t.id))+" ")]):e._e(),t.isGroup()?e._l(e.days(),(function(r){return n("td",{key:r,class:{"end-of-week":e.isEndOfWeek(e.day(r)),"start-of-group":!0,"full-space":!0}},[e.hasGroupErrors(t.id,e.day(r))?n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[n("div",e._g({staticClass:"errors"},r),[e._v("-")])]}}],null,!0)},e._l(e.getGroupErrors(t.id,e.day(r)),(function(t){return n("div",{key:t},[e._v(" "+e._s(t)+" ")])})),0):e._e()],1)})):e._e(),t.isSubgroup()?n("td",{staticClass:"start-of-subgroup end-of-week table-element-name-2",attrs:{colspan:"2"}},[e._v(" "+e._s(e.getSubgroupName(t.id))+" ")]):e._e(),t.isSubgroup()?e._l(e.days(),(function(r){return n("td",{key:r,class:{"end-of-week":e.isEndOfWeek(e.day(r)),"start-of-subgroup":!0,"full-space":!0}},[e.hasSubgroupErrors(t.id,e.day(r))?n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[n("div",e._g({staticClass:"errors"},r),[e._v("-")])]}}],null,!0)},e._l(e.getSubgroupErrors(t.id,e.day(r)),(function(t){return n("div",{key:t},[e._v(" "+e._s(t)+" ")])})),0):e._e()],1)})):e._e(),t.isEmployee()?n("td",{class:{"end-of-week":!0,"table-element-name-3":!0,"start-of-subgroup":e.isStartOfSubgroup(t.id)},attrs:{colspan:"2"}},[e._v(" "+e._s(t.id)+" - "+e._s(e.context.getEmployee(t.id).name)+" ")]):e._e(),t.isEmployee()?e._l(e.days(),(function(r){return n("td",{key:r,class:{"end-of-week":e.isEndOfWeek(e.day(r)),"start-of-subgroup":e.isStartOfSubgroup(t.id),"full-space":!0}},[e.hasEmployeeErrors(t.id,e.day(r))?n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(i){var a=i.on;return[n("span",e._g({},a),[n("WorkShiftInput",{attrs:{value:e.getShift(t.id,e.day(r)),items:e.availableStates(),hasErrors:!0},on:{"update-value":function(n){return e.handleShift(t.id,e.day(r),n)}}})],1)]}}],null,!0)},e._l(e.getEmployeeErrors(t.id,e.day(r)),(function(t){return n("div",{key:t},[e._v(" "+e._s(t)+" ")])})),0):n("WorkShiftInput",{attrs:{value:e.getShift(t.id,e.day(r)),items:e.availableStates(),hasErrors:!1},on:{"update-value":function(n){return e.handleShift(t.id,e.day(r),n)}}})],1)})):e._e()],2)})),n("tr",[n("td",{staticClass:"text-left",attrs:{rowspan:"2"}},[e._v("Mattina")]),n("td",{staticClass:"text-left end-of-week"},[e._v("Usate")]),e._l(e.days(),(function(t){return n("td",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0,errors:e.hasCarsErrors(e.morningAction(),e.day(t))}},[e.hasCarsErrors(e.morningAction(),e.day(t))?n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(r){var i=r.on;return[n("span",e._g({},i),[e._v(" "+e._s(e.getUsedCars(e.day(t),e.morningAction()))+" ")])]}}],null,!0)},[n("span",e._l(e.getCarsErrors(e.morningAction(),e.day(t)),(function(t){return n("div",{key:t},[e._v(" "+e._s(t)+" ")])})),0)]):n("span",[e._v(" "+e._s(e.getUsedCars(e.day(t),e.morningAction()))+" ")])],1)}))],2),n("tr",[n("td",{staticClass:"text-left end-of-week"},[e._v("Disponibili")]),e._l(e.days(),(function(t){return n("td",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0}},[e._v(" "+e._s(e.getTotCars())+" ")])}))],2),n("tr",[n("td",{staticClass:"text-left",attrs:{rowspan:"2"}},[e._v("Pomeriggio")]),n("td",{staticClass:"text-left end-of-week"},[e._v("Usate")]),e._l(e.days(),(function(t){return n("td",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0,errors:e.hasCarsErrors(e.afternoonAction(),e.day(t))}},[e.hasCarsErrors(e.afternoonAction(),e.day(t))?n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(r){var i=r.on;return[n("span",e._g({},i),[e._v(" "+e._s(e.getUsedCars(e.day(t),e.afternoonAction()))+" ")])]}}],null,!0)},[n("span",e._l(e.getCarsErrors(e.afternoonAction(),e.day(t)),(function(t){return n("div",{key:t},[e._v(" "+e._s(t)+" ")])})),0)]):n("span",[e._v(" "+e._s(e.getUsedCars(e.day(t),e.afternoonAction()))+" ")])],1)}))],2),n("tr",[n("td",{staticClass:"text-left end-of-week"},[e._v("Disponibili")]),e._l(e.days(),(function(t){return n("td",{key:t,class:{"end-of-week":e.isEndOfWeek(e.day(t)),"table-header":!0,"text-center":!0}},[e._v(" "+e._s(e.getTotCars())+" ")])}))],2)],2)]},proxy:!0}])})],1)],1)},v=[],d=(n("c740"),n("5db7"),n("73d9"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"text-center":!0,errors:e.hasErrors}},[n("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[n("span",e._g({},r),[e._v(e._s(e.value))])]}}])},[n("v-list",e._l(e.items,(function(t,r){return n("v-list-item",{key:r,on:{click:function(n){return e.select(t)}}},[n("v-list-item-title",[e._v(e._s(t))])],1)})),1)],1)],1)}),g=[],p=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"select",value:function(e){this.$emit("update-value",e)}}]),n}(f["c"]);Object(l["a"])([Object(f["b"])()],p.prototype,"items",void 0),Object(l["a"])([Object(f["b"])()],p.prototype,"value",void 0),Object(l["a"])([Object(f["b"])()],p.prototype,"hasErrors",void 0),p=Object(l["a"])([f["a"]],p);var y=p,m=y,k=(n("0324"),n("2877")),S=n("6544"),b=n.n(S),O=n("8860"),E=n("da13"),A=n("5d23"),_=n("e449"),w=Object(k["a"])(m,d,g,!1,null,"6a37c614",null),I=w.exports;b()(w,{VList:O["a"],VListItem:E["a"],VListItemTitle:A["a"],VMenu:_["a"]});var D;n("4de4"),n("c975");(function(e){e[e["IDLE"]=0]="IDLE",e[e["MORNING"]=1]="MORNING",e[e["AFTERNOON"]=2]="AFTERNOON",e[e["AWAY"]=3]="AWAY"})(D||(D={}));var N,W=function(){function e(){Object(o["a"])(this,e)}return Object(c["a"])(e,[{key:"getAllLabels",value:function(){var e=[];return this.getLabels(D.IDLE).forEach((function(t){return e.push(t)})),this.getLabels(D.MORNING).forEach((function(t){return e.push(t)})),this.getLabels(D.AFTERNOON).forEach((function(t){return e.push(t)})),this.getLabels(D.AWAY).forEach((function(t){return e.push(t)})),e}},{key:"getLabels",value:function(e){return e==D.MORNING?["M","M*"]:e==D.AFTERNOON?["P","P*","PJ"]:e==D.AWAY?["F","Rec","Agg","mal","/","L104"]:e==D.IDLE?[this.getIdleLabel()]:[]}},{key:"getActions",value:function(){return[D.MORNING,D.AFTERNOON,D.AWAY,D.IDLE]}},{key:"getActionName",value:function(e){switch(e){case D.MORNING:return"MORNING";case D.AFTERNOON:return"AFTERNOON";case D.AWAY:return"AWAY";case D.IDLE:return"IDLE"}}},{key:"getActionFromName",value:function(e){var t=this,n=this.getActions().filter((function(n){var r=t.getActionName(n);return r==e}));if(1==n.length)return n[0];throw new Error("Cannot convert [".concat(e,"] to an Action obj"))}},{key:"getIdleLabel",value:function(){return this.getDefaultLabel()}},{key:"getDefaultLabel",value:function(){return"---"}},{key:"getAction",value:function(e){if(-1!=this.getLabels(D.IDLE).indexOf(e))return D.IDLE;if(-1!=this.getLabels(D.MORNING).indexOf(e))return D.MORNING;if(-1!=this.getLabels(D.AFTERNOON).indexOf(e))return D.AFTERNOON;if(-1!=this.getLabels(D.AWAY).indexOf(e))return D.AWAY;throw new Error("Label ["+e+"] not recognized as an action")}}]),e}(),j=(n("ac1f"),n("1276"),n("4d63"),n("25f0"),n("b812")),C=(new j["LoggerFactoryOptions"]).addLogGroupRule(new j["LogGroupRule"](new RegExp("services.OptimizeShiftsService"),j["LogLevel"].Info)).addLogGroupRule(new j["LogGroupRule"](new RegExp("services.+"),j["LogLevel"].Info)).addLogGroupRule(new j["LogGroupRule"](new RegExp("utils.Decorators.StatsCollector"),j["LogLevel"].Error)).addLogGroupRule(new j["LogGroupRule"](new RegExp("utils.Cache.stats"),j["LogLevel"].Error)).addLogGroupRule(new j["LogGroupRule"](new RegExp("utils.Stats.stats"),j["LogLevel"].Error)).addLogGroupRule(new j["LogGroupRule"](new RegExp(".+"),j["LogLevel"].Info)),x=j["LFService"].createNamedLoggerFactory("LoggerFactory",C);(function(e){e[e["MONDAY"]=1]="MONDAY",e[e["TUESDAY"]=2]="TUESDAY",e[e["WEDNESDAY"]=3]="WEDNESDAY",e[e["THURSDAY"]=4]="THURSDAY",e[e["FRIDAY"]=5]="FRIDAY",e[e["SATURDAY"]=6]="SATURDAY",e[e["SUNDAY"]=0]="SUNDAY"})(N||(N={}));var T=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("services.DateService")}return Object(c["a"])(e,[{key:"isStartOfWeek",value:function(e){return this.getDayOfWeek(e)==N.MONDAY}},{key:"isEndOfWeek",value:function(e){return this.getDayOfWeek(e)==N.SUNDAY}},{key:"getStartOfMonth",value:function(e){return this.createDate(e.getFullYear(),e.getMonth(),1)}},{key:"getEndOfMonth",value:function(e){return this.createDate(e.getFullYear(),e.getMonth()+1,0)}},{key:"getStartOfWeek",value:function(e){var t=e;while(!this.isStartOfWeek(t))t=this.addDays(t,-1);return t}},{key:"getEndOfWeek",value:function(e){var t=e;while(!this.isEndOfWeek(t))t=this.addDays(t,1);return t}},{key:"getDayOfWeek",value:function(e){switch(e.getDay()){case 1:return N.MONDAY;case 2:return N.TUESDAY;case 3:return N.WEDNESDAY;case 4:return N.THURSDAY;case 5:return N.FRIDAY;case 6:return N.SATURDAY;case 0:return N.SUNDAY;default:throw new Error("Unrecognized date "+e)}}},{key:"getDayOfWeekLabel",value:function(e){switch(e){case N.MONDAY:return"L";case N.TUESDAY:return"M";case N.WEDNESDAY:return"M";case N.THURSDAY:return"G";case N.FRIDAY:return"V";case N.SATURDAY:return"S";case N.SUNDAY:return"D"}}},{key:"getDayOfWeekName",value:function(e){switch(e){case N.MONDAY:return"MONDAY";case N.TUESDAY:return"TUESDAY";case N.WEDNESDAY:return"WEDNESDAY";case N.THURSDAY:return"THURSDAY";case N.FRIDAY:return"FRIDAY";case N.SATURDAY:return"SATURDAY";case N.SUNDAY:return"SUNDAY"}}},{key:"getDayOfWeekFromName",value:function(e){var t=this,n=this.getDaysOfWeek().filter((function(n){var r=t.getDayOfWeekName(n);return r==e}));if(1==n.length)return n[0];throw new Error("Cannot convert [".concat(e,"] to a DayOfWeek obj"))}},{key:"getDaysOfWeek",value:function(){return[N.MONDAY,N.TUESDAY,N.WEDNESDAY,N.THURSDAY,N.FRIDAY,N.SATURDAY,N.SUNDAY]}},{key:"parse",value:function(e){var t=0,n=0,r=1;try{var i=e.split("-");t=parseInt(i[0]),n=parseInt(i[1])-1,3==i.length&&(r=parseInt(i[2]))}catch(a){throw Error("Text "+e+" is not a valid date."+a)}return this.createDate(t,n,r)}},{key:"format",value:function(e){var t=this,n=e.getFullYear(),r=e.getMonth()+1,i=e.getDate(),a=function(e){return t.leftPadding(""+e,"0",2)};return"".concat(n,"-").concat(a(r),"-").concat(a(i))}},{key:"formatShort",value:function(e){var t=this,n=e.getMonth()+1,r=e.getDate(),i=function(e){return t.leftPadding(""+e,"0",2)};return"".concat(i(r),"-").concat(i(n))}},{key:"formatYYYYMM",value:function(e){var t=this,n=e.getFullYear(),r=e.getMonth()+1,i=function(e){return t.leftPadding(""+e,"0",2)};return"".concat(n,"-").concat(i(r))}},{key:"isValidDate",value:function(e){return e instanceof Date&&!isNaN(e.getTime())}},{key:"range",value:function(e,t){var n=Array(),r=this.clone(e);while(!this.isAfter(r,t))n.push(r),r=this.addDays(r,1);return n}},{key:"isBefore",value:function(e,t){return e<t}},{key:"isAfter",value:function(e,t){return e>t}},{key:"createDate",value:function(e,t,n){var r=new Date(e,t,n);if(!this.isValidDate(r))throw Error("Not a valid date. ["+e+"] ["+t+"] ["+n+"]");return r.setHours(0,0,0,0),r}},{key:"getWeek",value:function(e){var t=this;this.logger.debug((function(){return"Input: ".concat(t.format(e))}));var n=this.getStartOfWeek(e),r=this.getEndOfWeek(e);return this.logger.debug((function(){return"Output: ".concat(t.format(n)," - ").concat(t.format(r))})),this.range(n,r)}},{key:"getWeeks",value:function(e){var t=this,n=e.map((function(e){return t.getWeek(e)})),r=new Array,i=function(e){return t.format(e[0])};return n.forEach((function(e){0==r.filter((function(t){return i(t)==i(e)})).length&&r.push(e)})),r}},{key:"clone",value:function(e){return new Date(e.getTime())}},{key:"addDays",value:function(e,t){var n=this.clone(e);return n.setDate(n.getDate()+t),n}},{key:"getWeekendDays",value:function(){var e=this;return this.getDaysOfWeek().filter((function(t){return e.isWeekend(t)}))}},{key:"getWeekdays",value:function(){var e=this;return this.getDaysOfWeek().filter((function(t){return!e.isWeekend(t)}))}},{key:"isWeekend",value:function(e){switch(e){case N.MONDAY:case N.TUESDAY:case N.WEDNESDAY:case N.THURSDAY:case N.FRIDAY:return!1;default:return!0}}},{key:"leftPadding",value:function(e,t,n){while(e.length<n)e=t+e;return e}}]),e}(),V=(n("13d5"),n("a630"),n("fb6a"),n("4ec9"),n("d3b7"),n("3ca3"),n("ddb0"),function(){return window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}),R=function(){function e(){Object(o["a"])(this,e),this.maxSize=1e3,this.ttl=500}return Object(c["a"])(e,[{key:"toString",value:function(){return"maxSize: ".concat(this.maxSize," ttl: ").concat(this.ttl)}}],[{key:"init",value:function(t,n){var r=new e;return r.maxSize=t,r.ttl=n,r}}]),e}(),M=function(){function e(){Object(o["a"])(this,e),this._instance=new R}return Object(c["a"])(e,[{key:"maxSize",value:function(e){return this._instance.maxSize=e,this}},{key:"ttl",value:function(e){return this._instance.ttl=e,this}},{key:"build",value:function(){return this._instance}}]),e}(),L=function e(t){Object(o["a"])(this,e),this.inserted=V(),this.value=t},G=function e(){Object(o["a"])(this,e),this.hits=0,this.miss=0,this.evict=0,this.size=0},z=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("utils.Cache.Cache"),this._entries=new Map,this._stats=new G,this.config=new R}return Object(c["a"])(e,[{key:"get",value:function(e){var t;this.validateEntry(e);var n=null===(t=this._entries.get(e))||void 0===t?void 0:t.value;return"undefined"!==typeof n?(this.logger.debug((function(){return"HIT! ".concat(e)})),this._stats.hits++):(this.logger.debug((function(){return"MISS! ".concat(e)})),this._stats.miss++),n}},{key:"put",value:function(e,t){var n=this;this.size()>=this.config.maxSize&&this.cleanup(),this.logger.debug((function(){return"SIZE: ".concat(n.size())})),this._stats.size=this.size(),this._entries.set(e,new L(t))}},{key:"evict",value:function(e){this.doEvict(e)}},{key:"validateEntry",value:function(e){if(this._entries.has(e)){var t=this._entries.get(e);V()-t.inserted>this.config.ttl&&(this.logger.debug((function(){return"Key is too old: ".concat(e)})),this.doEvict(e))}}},{key:"doEvict",value:function(e){this._stats.evict++,this._entries.delete(e)}},{key:"size",value:function(){return this._entries.size}},{key:"cleanup",value:function(){var e=this,t=Math.max(0,this.size()-this.config.maxSize);this.logger.debug((function(){return"Delete ".concat(t," entries")}));var n=Array.from(this._entries.entries()).sort((function(e,t){return e[1].inserted-t[1].inserted})).slice(0,t);n.map((function(t){return e.logger.debug((function(){return"Cleanup: ".concat(t[0])})),t})).forEach((function(t){return e.doEvict(t[0])}))}},{key:"stats",value:function(){return"HITS: ".concat(this._stats.hits," MISS: ").concat(this._stats.miss," EVICT: ").concat(this._stats.evict," SIZE: ").concat(this._stats.size)}},{key:"resetStats",value:function(){this._stats=new G}}]),e}(),Y=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("utils.Cache.CacheManager"),this._caches=new Map}return Object(c["a"])(e,[{key:"get",value:function(e){return this._caches.has(e)||this._caches.set(e,new z),this._caches.get(e)}},{key:"caches",get:function(){return this._caches}}],[{key:"getInstance",value:function(){return e._instance||(e._instance=new e),e._instance}}]),e}();setInterval((function(){var e=x.getLogger("utils.Cache.stats");Array.from(Y.getInstance().caches.entries()).forEach((function(t){e.info((function(){return"CACHE STATS [".concat(t[0],"] ").concat(t[1].stats()," ").concat(t[1].config)})),t[1].resetStats()}))}),1e4);var U=200,B=5,F=function(){function e(){Object(o["a"])(this,e),this._counter=0,this._longCallsCounter=0,this._durations=[]}return Object(c["a"])(e,[{key:"addDuration",value:function(e){this._durations.length>=U&&this._durations.shift(),this._durations.push(e),e>B&&this._longCallsCounter++}},{key:"increaseCounter",value:function(){return++this._counter}},{key:"durations",value:function(){return this._durations}},{key:"avg",value:function(){var e=this._durations.reduce((function(e,t){return e+t}),0);return e/this._durations.length}},{key:"weight",value:function(){return this.counter*this.avg()}},{key:"counter",get:function(){return this._counter}},{key:"longCalls",get:function(){return this._longCallsCounter}}]),e}(),P=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("utils.Stats.StatsCollector"),this._entries=new Map}return Object(c["a"])(e,[{key:"addEntry",value:function(e,t){this._entries.has(e)||this._entries.set(e,new F);var n=this._entries.get(e);n.increaseCounter(),n.addDuration(t)}},{key:"resetEntry",value:function(e){this._entries.delete(e)}},{key:"entries",get:function(){return this._entries}}],[{key:"getInstance",value:function(){return e._instance||(e._instance=new e),e._instance}},{key:"addEntry",value:function(t,n){e.getInstance().addEntry(t,n)}}]),e}();setInterval((function(){if(0!=P.getInstance().entries.size){var e=x.getLogger("utils.Stats.stats");e.info((function(){return"Count\t|\tLong (>= ".concat(B,"ms)\t|\tAvg (ms)\t|\tWeight\t|\tName")})),Array.from(P.getInstance().entries.entries()).sort((function(e,t){return e[1].weight()-t[1].weight()})).reverse().forEach((function(t){e.info((function(){return"".concat(t[1].counter,"\t|\t").concat(t[1].longCalls,"\t|\t").concat(t[1].avg().toPrecision(4),"\t|\t").concat(t[1].weight().toPrecision(4),"\t|\t").concat(t[0])})),P.getInstance().resetEntry(t[0])}))}}),1e4);var $=function(){return window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()};function J(e){var t=x.getLogger("utils.Decorators.stats");return function(n,r,i){var a=i.value,o=void 0!=e?"".concat(e,".").concat(r):r;return i.value=function(){t.debug((function(){return"Call ".concat(o," start")}));var e=$();try{for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var c=a.apply(this,r),s=$()-e;return t.debug((function(){return"Call ".concat(o," end [").concat(s,"]")})),P.addEntry(o,s),c}catch(l){var u=$()-e;throw t.error((function(){return"Call ".concat(o," failed [").concat(u,"]")})),l}},i}}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},n=arguments.length>2?arguments[2]:void 0;x.getLogger("utils.Decorators.cacheable");return function(r,i,a){var o=a.value;return a.value=function(){var r=Y.getInstance().get(e);n&&(r.config=n);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];var s=t(a),u=r.get(s);if("undefined"!==typeof u)return u;var l=o.apply(this,a);return r.put(s,l),l},a}}var Z=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("services.WorkShiftService"),this.actionService=Le.getInstance().getActionService(),this.dateService=Le.getInstance().getDateService()}return Object(c["a"])(e,[{key:"countByEmployeesDatesAction",value:function(e,t,n,r){var i=this;return e.flatMap((function(e){return t.map((function(t){return i.getAction(r,e,t)})).filter((function(e){return e==n}))})).length}},{key:"countByEmployeesDatesActions",value:function(e,t,n,r){var i=this;return n.map((function(n){return i.countByEmployeesDatesAction(e,t,n,r)})).reduce((function(e,t){return e+t}))}},{key:"hasEntry",value:function(e,t,n){return e.filter((function(e){return e.employeeId==t.id})).filter((function(e){return e.date==n})).length>0}},{key:"getAction",value:function(e,t,n){var r=e.getShift(t,n,this.actionService.getDefaultLabel());return this.actionService.getAction(r)}},{key:"rangeStart",value:function(e){var t=this.dateService.getStartOfMonth(e);return this.dateService.getStartOfWeek(t)}},{key:"rangeEnd",value:function(e){var t=this.dateService.getEndOfMonth(e);return this.dateService.getEndOfWeek(t)}},{key:"isWeekendWorking",value:function(e,t,n){var r=this.dateService.getEndOfWeek(t),i=[this.dateService.addDays(r,-1),r],a=this.countByEmployeesDatesActions([e],i,[D.MORNING,D.AFTERNOON,D.AWAY],n);return a>0}},{key:"isPreviousWeekendWorking",value:function(e,t,n){var r=this.dateService.getStartOfWeek(t),i=[this.dateService.addDays(r,-2),this.dateService.addDays(r,-1)],a=this.countByEmployeesDatesActions([e],i,[D.MORNING,D.AFTERNOON,D.AWAY],n);return a>0}},{key:"getExpectedEmployeeTotShiftsInWeek",value:function(e,t,n){this.dateService.getWeek(t);var r=n.getEmployee(e),i=r.totWeekShifts;return this.isWeekendWorking(e,t,n)&&i++,this.isPreviousWeekendWorking(e,t,n)&&i--,i}},{key:"getExpectedEmployeeMorningShiftsInWeek",value:function(e,t,n){this.dateService.getWeek(t);var r=n.getEmployee(e),i=r.maxWeekMornings;return this.isWeekendWorking(e,t,n)&&i++,this.isPreviousWeekendWorking(e,t,n)&&i--,i}},{key:"getExpectedEmployeeAfternoonShiftsInWeek",value:function(e,t,n){var r=n.getEmployee(e);return r.maxWeekAfternoons}}]),e}();Object(l["a"])([J("WorkShiftService.cached"),H("WorkShiftService.countByEmployeesDatesAction",(function(e){return e[0]+"_"+e[1].map((function(e){return e.toISOString()}))+"_"+e[2]}),(new M).maxSize(2e3).build()),J("WorkShiftService.raw")],Z.prototype,"countByEmployeesDatesAction",null),Object(l["a"])([J("WorkShiftService")],Z.prototype,"isWeekendWorking",null),Object(l["a"])([J("WorkShiftService")],Z.prototype,"isPreviousWeekendWorking",null);var q=n("45eb"),K=n("7e84"),Q=function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService()},X=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.logger=x.getLogger("services.TotalShiftsPerWeek"),e}return Object(c["a"])(n,[{key:"errors",value:function(e,t,n){var r=new Array;if(null==e)return r;var i=this.dateService.getWeek(t),a=this.workShiftService.countByEmployeesDatesActions([e],i,[D.MORNING,D.AFTERNOON,D.AWAY],n),o=n.getEmployee(e),c=this.workShiftService.getExpectedEmployeeTotShiftsInWeek(e,t,n);return a!=c&&r.push("".concat(o.name," dovrebbe lavorare ").concat(c," turni in una settimana, presenti ").concat(a)),r}}]),n}(Q);Object(l["a"])([J("ShiftValidationService.TotalShiftsPerWeek")],X.prototype,"errors",null);var ee=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.logger=x.getLogger("services.MinShiftPerWeek"),e}return Object(c["a"])(n,[{key:"errors",value:function(e,t,n){var r=new Array;if(null==e)return r;var i=this.dateService.getWeek(t),a=n.getEmployee(e),o=this.workShiftService.getExpectedEmployeeMorningShiftsInWeek(e,t,n),c=this.workShiftService.countByEmployeesDatesAction([e],i,D.MORNING,n),s=this.workShiftService.getExpectedEmployeeAfternoonShiftsInWeek(e,t,n),u=this.workShiftService.countByEmployeesDatesAction([e],i,D.AFTERNOON,n);return o<c&&r.push("".concat(a.name," dovrebbe lavorare al massimo ").concat(o," mattine la settimana, presenti ").concat(c)),s<u&&r.push("".concat(a.name," dovrebbe lavorare al massimo ").concat(s," pomeriggi la settimana, presenti ").concat(u)),r}}]),n}(Q);Object(l["a"])([J("ShiftValidationService.MaxShiftByTypePerWeek")],ee.prototype,"errors",null);var te=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(e){var r;return Object(o["a"])(this,n),r=t.call(this),r.logger=x.getLogger("services.MaxCarsPerShift"),r.action=e,r}return Object(c["a"])(n,[{key:"errors",value:function(e,t,n){var r=new Array,i=Array.from(n.employees.values()).map((function(e){return e.id})),a=this.workShiftService.countByEmployeesDatesAction(i,[t],this.action,n);return a>n.availableCars.total&&(this.action==D.MORNING&&r.push("Disponibili ".concat(n.availableCars.total," auto al mattino, assegnate ").concat(a,".")),this.action==D.AFTERNOON&&r.push("Disponibili ".concat(n.availableCars.total," auto al pomeriggio, assegnate ").concat(a,"."))),r}}]),n}(Q);Object(l["a"])([J("ShiftValidationService.MaxCarsPerShift")],te.prototype,"errors",null);var ne=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.logger=x.getLogger("services.AbstractMinShiftsPerGroup"),this.workShiftService=Le.getInstance().getWorkShiftService()}return Object(c["a"])(e,[{key:"errors",value:function(e,t,n){var r=this,i=new Array;if(null==e)return i;var a=this.getGroup(e,n),o=this.dateService.getDayOfWeek(t);if("undefined"===typeof a)return i;var c=Array.from(n.employees.values()).filter((function(e){var t;return(null===(t=r.getGroupByEmployee(e,n))||void 0===t?void 0:t.id)==a.id})).map((function(e){return e.id})),s=Le.getInstance().getWeekConstraintService().getMinValue(a.constraints,o,D.MORNING)||0,u=this.workShiftService.countByEmployeesDatesAction(c,[t],D.MORNING,n),l=Le.getInstance().getWeekConstraintService().getMinValue(a.constraints,o,D.AFTERNOON)||0,f=this.workShiftService.countByEmployeesDatesAction(c,[t],D.AFTERNOON,n);return s>u&&i.push("Nel gruppo ".concat(a.name," al mattino sono richieste almeno ").concat(s," risorse, presenti ").concat(u)),l>f&&i.push("Nel gruppo ".concat(a.name," al pomeriggio sono richieste almeno ").concat(l," risorse, presenti ").concat(f)),i}}]),e}(),re=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"errors",value:function(e,t,r){return Object(q["a"])(Object(K["a"])(n.prototype),"errors",this).call(this,e,t,r)}},{key:"getGroup",value:function(e,t){return t.getGroupById(e)}},{key:"getGroupByEmployee",value:function(e,t){return t.getGroupByEmployee(e.id)}}]),n}(ne);Object(l["a"])([J("ShiftValidationService.MinShiftsPerGroup")],re.prototype,"errors",null);var ie=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"errors",value:function(e,t,r){return Object(q["a"])(Object(K["a"])(n.prototype),"errors",this).call(this,e,t,r)}},{key:"getGroup",value:function(e,t){return t.getSubgroupById(e)}},{key:"getGroupByEmployee",value:function(e,t){return t.getSubgroupByEmployee(e.id)}}]),n}(ne);Object(l["a"])([J("ShiftValidationService.MinShiftsPerSubGroup")],ie.prototype,"errors",null);var ae=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("services.ShiftValidationService"),this.dateService=Le.getInstance().getDateService()}return Object(c["a"])(e,[{key:"getEmployeeErrors",value:function(e,t,n){return this.employeeErrors(e,t,n,[new X,new ee,new te(D.MORNING),new te(D.AFTERNOON)])}},{key:"getGroupErrors",value:function(e,t,n){return this.groupErrors(e,t,n,[new re])}},{key:"getSubgroupErrors",value:function(e,t,n){return this.groupErrors(e,t,n,[new ie])}},{key:"getCarsErrors",value:function(e,t,n){return this.employeeErrors(null,e,n,[new te(t)])}},{key:"employeeErrors",value:function(e,t,n,r){var i=this,a=r.flatMap((function(r){return r.errors(e,t,n)}));return this.logger.debug((function(){return"Validate employee ".concat(e," day ").concat(i.dateService.format(t)," errors ").concat(a)})),a}},{key:"groupErrors",value:function(e,t,n,r){var i=this,a=r.flatMap((function(r){return r.errors(e,t,n)}));return this.logger.debug((function(){return"Validate employee ".concat(e," day ").concat(i.dateService.format(t)," errors ").concat(a)})),a}}]),e}(),oe="min",ce=function(){function e(t,n,r,i){Object(o["a"])(this,e),this._dayOfWeek=N.MONDAY,this._action=D.IDLE,this._type="",this._value=0,this.dayOfWeek=t,this.action=n,this.value=r,this.type=i}return Object(c["a"])(e,[{key:"clone",value:function(){return new e(this.dayOfWeek,this.action,this.value,this.type)}},{key:"dayOfWeek",get:function(){return this._dayOfWeek},set:function(e){this._dayOfWeek=e}},{key:"action",get:function(){return this._action},set:function(e){this._action=e}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"value",get:function(){return this._value},set:function(e){this._value=e}}],[{key:"min",value:function(t,n,r){return new e(t,n,r,oe)}}]),e}(),se=function(){function e(){Object(o["a"])(this,e)}return Object(c["a"])(e,[{key:"entries",value:function(e,t,n,r){return e.filter((function(e){return void 0!=t&&t==e.dayOfWeek})).filter((function(e){return void 0!=n&&n==e.action})).filter((function(e){return void 0!=r&&r==e.type}))}},{key:"getMinValue",value:function(e,t,n){var r=this.entries(e,t,n,oe);if(0!=r.length)return r[0].value}}]),e}(),ue=n("bc3a"),le=n.n(ue),fe=new r["default"],he=fe,ve=function(){function e(){Object(o["a"])(this,e),this.logger=x.getLogger("utils.WebService"),this._url="",this._method=void 0,this._headers={},this._responseType="json",this._spinner=!0,this._requestSerializer=function(e){return JSON.stringify(e)}}return Object(c["a"])(e,[{key:"url",value:function(e){return this._url=e,this}},{key:"header",value:function(e,t){return this._headers[e]=t,this}},{key:"responseType",value:function(e){return this._responseType=e,this}},{key:"headerJson",value:function(){return this.header("Content-Type","application/json; charset=utf-8"),this}},{key:"method",value:function(e){return this._method=e,this}},{key:"get",value:function(){return this.method("get")}},{key:"post",value:function(){return this.method("post")}},{key:"requestSerializer",value:function(e){return this._requestSerializer=e,this}},{key:"spinner",value:function(e){return this._spinner=e,this}},{key:"call",value:function(e){var t=this,n=$(),r=this._url,i=le.a.create();return i.interceptors.request.use((function(e){return t.logger.debug((function(){return"Call ".concat(e.url," start")})),e})),i.interceptors.response.use((function(e){var r=$()-n;return t.logger.info((function(){return"Call ".concat(e.config.url," end [").concat(r,"] status [").concat(e.status,"] ").concat(e.statusText)})),e}),(function(e){var r=$()-n;throw t.logger.error((function(){return"Call ".concat(e.config.url," failed [").concat(r,"]")})),{data:e.response.data}})),i.interceptors.request.use((function(e){return t._spinner&&he.$emit("ASYNC_ACTION_START",r),e})),i.interceptors.response.use((function(e){return t._spinner&&he.$emit("ASYNC_ACTION_END","".concat(r," ok")),e}),(function(e){throw t._spinner&&he.$emit("ASYNC_ACTION_END","".concat(r," ko")),e})),i({url:this._url,method:this._method,headers:this._headers,responseType:this._responseType,data:this._requestSerializer(e)})}}]),e}(),de=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.configs=[{env:"test",frontendUrls:["http://localhost:8080"],backendUrl:"http://localhost:8081"},{env:"prod",frontendUrls:["http://vitalegi.ovh:3000","https://vitalegi.ovh:3000"],backendUrl:"https://vitalegi.ovh:3000"}],e}return Object(c["a"])(n,[{key:"url",value:function(e){var t=this,r=this.getBackendUrl()+e;return this.logger.debug((function(){return"BackendURL: ".concat(t.getBackendUrl()," URL: ").concat(e," WindowLocation: ").concat(window.location)})),Object(q["a"])(Object(K["a"])(n.prototype),"url",this).call(this,r)}},{key:"getBackendUrl",value:function(){var e=this.getCurrentUrl(),t=this.configs.filter((function(t){return t.frontendUrls.filter((function(t){return t==e})).length>0}));return 1==t.length?t[0].backendUrl:(this.logger.error((function(){return"Unrecognized environment: ".concat(e,". Fallback to default.")})),e)}},{key:"getCurrentUrl",value:function(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}}]),n}(ve),ge=(n("a434"),function e(t,n,r){Object(o["a"])(this,e),this.title="",this.message="",this.title=t,this.message=n,this.wsError=r}),pe=function(){function e(){Object(o["a"])(this,e),this.notifications=new Array}return Object(c["a"])(e,[{key:"add",value:function(e){this.notifications.push(e)}},{key:"count",value:function(){return this.notifications.length}},{key:"has",value:function(){return this.notifications.length>0}},{key:"pop",value:function(){if(!this.has())throw new Error("Empty list");return this.notifications.splice(0,1)[0]}},{key:"get",value:function(){if(!this.has())throw new Error("Empty list");return this.notifications[0]}}]),e}(),ye=x.getLogger("services.OptimizeShiftsService"),me=2147483647,ke=function e(t,n,r){Object(o["a"])(this,e),this.name="",this.min=0,this.max=0,this.name=t,this.min=n,this.max=r},Se=function e(t,n){Object(o["a"])(this,e),this.variable=t,this.coefficient=n},be=function(){function e(t,n){Object(o["a"])(this,e),this._name=t,this._coefficient=n}return Object(c["a"])(e,[{key:"name",get:function(){return this._name}},{key:"coefficient",get:function(){return this._coefficient}}]),e}(),Oe=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];Object(o["a"])(this,e),this.name="",this.min=0,this.max=0,this.context=t,this.name=n,this.min=r,this.max=i,this.coefficients=a}return Object(c["a"])(e,[{key:"addCoefficient",value:function(e,t){if(this.coefficients.filter((function(t){return t.variable.name==e})).length>0)throw new Error("Cannot add coefficient ".concat(e," to constraint ").concat(name,". Coefficient already exists."));return this.coefficients.push(new Se(this.context.getVariable(e),t)),this}}]),e}(),Ee=function(e){var t=e.coefficients.map((function(e){return"".concat(e.variable.name," [").concat(e.coefficient,"]")})).reduce((function(e,t){return e+"\n -- "+t}),"");return"".concat(e.name,", min/max: ").concat(e.min,"/").concat(e.max,". coefficients:").concat(t)},Ae=function(e){var t=Le.getInstance().getDateService(),n=t.getDayOfWeekName(t.getDayOfWeek(e));return t.format(e)+"_"+n},_e=function(e,t,n){var r=Ae(t),i=Le.getInstance().getActionService().getActionName(n);return"".concat(e,"_").concat(r,"_").concat(i)},we=function(){function e(){Object(o["a"])(this,e),this.variables=new Map,this.constraints=new Map,this.objectives=new Array}return Object(c["a"])(e,[{key:"addVariable",value:function(e,t,n){if(ye.debug((function(){return"addVariable [".concat(e,"] ").concat(t,"/").concat(n)})),this.variables.has(e))throw new Error("Variable ".concat(e," already exists."));var r=new ke(e,t,n);return this.variables.set(e,r),r}},{key:"addConstraint",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(ye.debug((function(){return"addConstraint [".concat(e,"] ").concat(t,"/").concat(n)})),this.constraints.has(e))throw new Error("Constraint [".concat(e,"] already exists."));var i=new Oe(this,e,t,n,r);return this.constraints.set(e,i),i}},{key:"getVariable",value:function(e){var t=this.variables.get(e);if(t)return t;throw new Error("Variable [".concat(e,"] doesn't exist."))}},{key:"getConstraint",value:function(e){var t=this.constraints.get(e);if(t)return t;throw new Error("Constraint [".concat(e,"] doesn't exist."))}},{key:"hasVariable",value:function(e){return this.variables.has(e)}},{key:"hasConstraint",value:function(e){return this.constraints.has(e)}},{key:"variableNames",value:function(){return Array.from(this.variables.entries()).map((function(e){return e[0]}))}},{key:"constraintNames",value:function(){return Array.from(this.constraints.entries()).map((function(e){return e[0]}))}},{key:"variableValues",value:function(){return Array.from(this.variables.values())}},{key:"constraintValues",value:function(){return Array.from(this.constraints.values())}},{key:"addObjectiveCoefficient",value:function(e,t){this.objectives.push(new be(e,t))}},{key:"getObjectives",value:function(){return this.objectives}}]),e}(),Ie=function(){function e(){Object(o["a"])(this,e)}return Object(c["a"])(e,[{key:"serialize",value:function(e){var t=this,n={variables:e.variableValues().map((function(e){return t.serializeVariable(e)})),constraints:e.constraintValues().map((function(e){return t.serializeConstraint(e)})),objective:e.getObjectives().map((function(e){return t.serializeObjective(e)}))};return n}},{key:"serializeVariable",value:function(e){return{name:e.name,max:e.max,min:e.min}}},{key:"serializeConstraint",value:function(e){var t=this;return{name:e.name,max:e.max,min:e.min,coefficients:e.coefficients.map((function(e){return t.serializeCoefficient(e)}))}}},{key:"serializeCoefficient",value:function(e){var t=this.serializeVariable(e.variable);return t.coefficient=e.coefficient,t}},{key:"serializeObjective",value:function(e){return{name:e.name,coefficient:e.coefficient}}}]),e}(),De=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService()}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this;ye.debug((function(){return"EmployeeVariable employeeId[".concat(n,"] date[").concat(i.dateService.format(r),"]")}));var a=this.workShiftService.getAction(e,n,r);a==D.IDLE&&(this.dateService.isWeekend(this.dateService.getDayOfWeek(r))?(this.addVariable(t,n,r,D.MORNING,0,0),this.addVariable(t,n,r,D.AFTERNOON,0,0),this.addVariable(t,n,r,D.AWAY,0,0),this.addVariable(t,n,r,D.IDLE,0,0)):(this.addVariable(t,n,r,D.MORNING,0,1),this.addVariable(t,n,r,D.AFTERNOON,0,1),this.addVariable(t,n,r,D.AWAY,0,0),this.addVariable(t,n,r,D.IDLE,0,1))),a==D.MORNING&&(this.addVariable(t,n,r,D.MORNING,1,1),this.addVariable(t,n,r,D.AFTERNOON,0,0),this.addVariable(t,n,r,D.AWAY,0,0),this.addVariable(t,n,r,D.IDLE,0,0)),a==D.AFTERNOON&&(this.addVariable(t,n,r,D.MORNING,0,0),this.addVariable(t,n,r,D.AFTERNOON,1,1),this.addVariable(t,n,r,D.AWAY,0,0),this.addVariable(t,n,r,D.IDLE,0,0)),a==D.AWAY&&(this.addVariable(t,n,r,D.MORNING,0,0),this.addVariable(t,n,r,D.AFTERNOON,0,0),this.addVariable(t,n,r,D.AWAY,1,1),this.addVariable(t,n,r,D.IDLE,0,0))}},{key:"addVariable",value:function(e,t,n,r,i,a){var o=this,c=_e(t,n,r);ye.debug((function(){return"EmployeeVariable employeeId[".concat(t,"] date[").concat(o.dateService.format(n),"] action[").concat(r,"] variable[").concat(c,"] ").concat(i,"/").concat(a)})),e.addVariable(c,i,a)}}]),e}(),Ne=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService()}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this;ye.debug((function(){return"EmployeeDailyConstraint employeeId[".concat(n,"] date[").concat(i.dateService.format(r),"]")}));var a=t.addConstraint(this.oneActivityPerDay(n,r),0,1);a.addCoefficient(_e(n,r,D.MORNING),1).addCoefficient(_e(n,r,D.AFTERNOON),1).addCoefficient(_e(n,r,D.AWAY),1).addCoefficient(_e(n,r,D.IDLE),1),ye.debug((function(){return"EmployeeDailyConstraint employeeId[".concat(n,"] date[").concat(i.dateService.format(r),"] ==> ").concat(Ee(a))}))}},{key:"oneActivityPerDay",value:function(e,t){return"".concat(e,"_").concat(Ae(t),"_one_activity_per_day")}}]),e}(),We=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService()}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this;ye.debug((function(){return"EmployeeWeeklyTotConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"]")}));var a=this.workShiftService.getExpectedEmployeeTotShiftsInWeek(n,r[0],e),o=t.addConstraint(this.employeeWeeklyTotActivities(n,r),0,a);r.forEach((function(e){o.addCoefficient(_e(n,e,D.MORNING),1),o.addCoefficient(_e(n,e,D.AFTERNOON),1)})),ye.debug((function(){return"EmployeeWeeklyTotConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"] ==> ").concat(Ee(o))}))}},{key:"employeeWeeklyTotActivities",value:function(e,t){return"".concat(e,"_").concat(Ae(t[0]),"_tot_activities_per_week")}}]),e}(),je=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService()}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this;ye.debug((function(){return"EmployeeWeeklyMorningsConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"]")}));var a=this.workShiftService.getExpectedEmployeeMorningShiftsInWeek(n,r[0],e),o=t.addConstraint(this.employeeWeeklyMorningActivities(n,r),0,a);r.forEach((function(e){o.addCoefficient(_e(n,e,D.MORNING),1)})),ye.debug((function(){return"EmployeeWeeklyMorningsConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"] ==> ").concat(Ee(o))}))}},{key:"employeeWeeklyMorningActivities",value:function(e,t){return"".concat(e,"_").concat(Ae(t[0]),"_morning_activities_per_week")}}]),e}(),Ce=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService()}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this;ye.debug((function(){return"EmployeeWeeklyAfternoonsConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"]")}));var a=this.workShiftService.getExpectedEmployeeAfternoonShiftsInWeek(n,r[0],e),o=t.addConstraint(this.employeeWeeklyAfternoonActivities(n,r),0,a);r.forEach((function(e){o.addCoefficient(_e(n,e,D.AFTERNOON),1)})),ye.debug((function(){return"EmployeeWeeklyAfternoonsConstraint employeeId[".concat(n,"] dates[").concat(r.map((function(e){return i.dateService.format(e)})),"] ==> ").concat(Ee(o))}))}},{key:"employeeWeeklyAfternoonActivities",value:function(e,t){return"".concat(e,"_").concat(Ae(t[0]),"_afternoon_activities_per_week")}}]),e}(),xe=function(){function e(t){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.actionService=Le.getInstance().getActionService(),this._action=t}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n){var r=this;ye.debug((function(){return"CarsDailyConstraint date[".concat(r.dateService.format(n),"] action[").concat(r.actionService.getActionName(r._action),"]")}));var i=e.availableCars.total,a=t.addConstraint(this.carsDailyActivities(n,this._action),0,i),o=Array.from(e.employees.values());o.map((function(e){return e.id})).forEach((function(e){a.addCoefficient(_e(e,n,r._action),1)})),ye.debug((function(){return"CarsDailyConstraint date[".concat(r.dateService.format(n),"] action[").concat(r.actionService.getActionName(r._action),"] ==> ").concat(Ee(a))}))}},{key:"carsDailyActivities",value:function(e,t){var n=this.actionService.getActionName(t);return"cars_".concat(Ae(e),"_").concat(n)}}]),e}(),Te=function(){function e(t){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.actionService=Le.getInstance().getActionService(),this.weekConstraintService=Le.getInstance().getWeekConstraintService(),this._action=t}return Object(c["a"])(e,[{key:"apply",value:function(e,t,n,r){var i=this,a=this.getEmployeeIdsInGroup(e,n),o=this.getGroup(e,n);if(this.dateService.isWeekend(this.dateService.getDayOfWeek(r)))ye.debug((function(){return"AbstractGroupDailyConstraint groupId[".concat(n,"][").concat(o.name,"] dates[").concat(i.dateService.format(r),"] ").concat(a.map((function(e){return"employeeId[".concat(e,"], is a weekend, skip constraint.")})))}));else{ye.debug((function(){return"AbstractGroupDailyConstraint groupId[".concat(n,"][").concat(o.name,"] dates[").concat(i.dateService.format(r),"] ").concat(a.map((function(e){return"employeeId[".concat(e,"]")})))}));var c=this.getExpectedMin(o,r),s=t.addConstraint(this.getConstraintName(n,r,this._action),c,me);a.forEach((function(e){s.addCoefficient(_e(e,r,i._action),1)})),ye.debug((function(){return"AbstractGroupDailyConstraint groupId[".concat(n,"][").concat(o.name,"] dates[").concat(i.dateService.format(r),"] ").concat(a.map((function(e){return"employeeId[".concat(e,"]")}))," ==> ").concat(Ee(s))}))}}},{key:"getExpectedMin",value:function(e,t){var n=this.dateService.getDayOfWeek(t);return this.weekConstraintService.getMinValue(e.constraints,n,this._action)||0}},{key:"groupDailyActivities",value:function(e,t,n,r){var i=this.actionService.getActionName(r);return"".concat(e,"_").concat(t,"_").concat(Ae(n),"_").concat(i)}}]),e}(),Ve=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"getEmployeeIdsInGroup",value:function(e,t){return Array.from(e.employees.values()).map((function(e){return e.id})).filter((function(n){var r;return(null===(r=e.getGroupByEmployee(n))||void 0===r?void 0:r.id)==t}))}},{key:"getGroup",value:function(e,t){var n=e.getGroupById(t);if(n)return n;throw new Error("Group ".concat(t," doesn't exist"))}},{key:"getConstraintName",value:function(e,t,r){return Object(q["a"])(Object(K["a"])(n.prototype),"groupDailyActivities",this).call(this,"GROUP",e,t,r)}}]),n}(Te),Re=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"getEmployeeIdsInGroup",value:function(e,t){return Array.from(e.employees.values()).map((function(e){return e.id})).filter((function(n){var r;return(null===(r=e.getSubgroupByEmployee(n))||void 0===r?void 0:r.id)==t}))}},{key:"getGroup",value:function(e,t){var n=e.getSubgroupById(t);if(n)return n;throw new Error("Subgroup ".concat(t," doesn't exist"))}},{key:"getConstraintName",value:function(e,t,r){return Object(q["a"])(Object(K["a"])(n.prototype),"groupDailyActivities",this).call(this,"SUBGROUP",e,t,r)}}]),n}(Te),Me=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.workShiftService=Le.getInstance().getWorkShiftService(),this.actionService=Le.getInstance().getActionService()}return Object(c["a"])(e,[{key:"optimize",value:function(e){var t=this,n=this.createOptimizationContext(e),r=new Ie;(new de).url("/workshifts-rest/optimize").post().headerJson().call(r.serialize(n)).then((function(n){var r=n.data,i=new Map;r.forEach((function(e){return i.set(e.name,e.value)})),t.validateSolutions(e,i),t.range(e.date).forEach((function(n){e.sortedEmployees().forEach((function(r){t.updateContext(e,i,r,n)}))}))})).catch((function(e){Le.getInstance().getErrorNotifications().add(new ge("Error","Error optimizing shift"))}))}},{key:"createOptimizationContext",value:function(e){var t=new we,n=this.range(e.date),r=this.dateService.getWeeks(n);n.forEach((function(n){e.sortedEmployees().forEach((function(r){(new De).apply(e,t,r,n),(new Ne).apply(e,t,r,n)}))})),r.forEach((function(n){e.sortedEmployees().forEach((function(r){(new We).apply(e,t,r,n),(new je).apply(e,t,r,n),(new Ce).apply(e,t,r,n)}))}));var i=[new Ve(D.MORNING),new Ve(D.AFTERNOON)];n.forEach((function(n){e.groups.forEach((function(r){i.forEach((function(i){i.apply(e,t,r.id,n)}))}))}));var a=[new Re(D.MORNING),new Re(D.AFTERNOON)];n.forEach((function(n){e.subgroups.forEach((function(r){a.forEach((function(i){i.apply(e,t,r.id,n)}))}))}));var o=[new xe(D.MORNING),new xe(D.AFTERNOON)];return n.forEach((function(n){o.forEach((function(r){r.apply(e,t,n)}))})),[D.MORNING,D.AFTERNOON].forEach((function(r){return n.forEach((function(n){e.sortedEmployees().forEach((function(e){t.addObjectiveCoefficient(_e(e,n,r),1)}))}))})),ye.isDebugEnabled()&&(t.constraintNames().forEach((function(e){var n=t.getConstraint(e),r=n.coefficients.map((function(e){return"".concat(e.variable.name," [").concat(e.coefficient,"]")})).reduce((function(e,t){return e+"\n -- "+t}),"");ye.debug((function(){return"C: ".concat(n.name,", min/max: ").concat(n.min,"/").concat(n.max,". coefficients:").concat(r)}))})),t.getObjectives().forEach((function(e){ye.debug((function(){return"O: ".concat(e.name," ").concat(e.coefficient)}))}))),ye.info((function(){return"Optimize ".concat(t.variableNames().length," variables and ").concat(t.constraintNames().length," constraints")})),t}},{key:"updateContext",value:function(e,t,n,r){var i=this,a=this.actionService.getActions().map((function(e){var a=i.getSolution(t,n,r,e);return[e,a]})).filter((function(e){return 1==e[1]})).map((function(e){return e[0]})),o=1==a.length?a[0]:D.IDLE,c=this.actionService.getAction(e.getShift(n,r));o!=c&&(ye.debug((function(){return"Optimization output, update shift employeeId ".concat(n,", date ").concat(i.dateService.format(r),", ").concat(i.actionService.getActionName(c)," ==> ").concat(i.actionService.getActionName(o))})),e.setShift(n,r,this.actionService.getLabels(o)[0]))}},{key:"validateSolutions",value:function(e,t){var n=this,r=this.range(e.date),i=e.sortedEmployees(),a=this.actionService.getActions();r.forEach((function(e){i.forEach((function(r){var i=new Map;a.forEach((function(a){var o=n.getSolution(t,r,e,a);if(0!=o&&1!=o)throw Error("employeeId ".concat(r," date ").concat(n.dateService.format(e)," action ").concat(n.actionService.getActionName(a),", invalid value: ").concat(o,", expected 0 or 1."));i.set(a,o)}));var o=Array.from(i.entries()).filter((function(e){return 1==e[1]})).map((function(e){return e[0]}));if(o.length>1)throw Error("employeeId ".concat(r," date ").concat(n.dateService.format(e),", more than one selection."))}))}))}},{key:"getSolution",value:function(e,t,n,r){var i=this,a=_e(t,n,r);return e.has(a)?e.get(a):(ye.info((function(){return"employeeId ".concat(t," date ").concat(i.dateService.format(n)," action ").concat(i.actionService.getActionName(r)," doesn't exist in the solution")})),0)}},{key:"range",value:function(e){return this.dateService.range(this.rangeStart(e),this.rangeEnd(e))}},{key:"rangeStart",value:function(e){return this.workShiftService.rangeStart(e)}},{key:"rangeEnd",value:function(e){return this.workShiftService.rangeEnd(e)}}]),e}();Object(l["a"])([J("OptimizeShiftsService")],Me.prototype,"optimize",null),Object(l["a"])([J("OptimizeShiftsService")],Me.prototype,"createOptimizationContext",null),Object(l["a"])([J("OptimizeShiftsService")],Me.prototype,"updateContext",null),Object(l["a"])([J("OptimizeShiftsService")],Me.prototype,"validateSolutions",null),Object(l["a"])([J("OptimizeShiftsService")],Me.prototype,"getSolution",null);var Le=function(){function e(){Object(o["a"])(this,e),this._instances={}}return Object(c["a"])(e,[{key:"getActionService",value:function(){return this.getService("ActionService",(function(){return new W}))}},{key:"getDateService",value:function(){return this.getService("DateService",(function(){return new T}))}},{key:"getWorkShiftService",value:function(){return this.getService("WorkShiftService",(function(){return new Z}))}},{key:"getShiftValidationService",value:function(){return this.getService("ShiftValidationService",(function(){return new ae}))}},{key:"getOptimizeShiftsService",value:function(){return this.getService("OptimizeShiftsService",(function(){return new Me}))}},{key:"getWeekConstraintService",value:function(){return this.getService("WeekConstraintService",(function(){return new se}))}},{key:"getErrorNotifications",value:function(){return this.getService("GlobalNotification",(function(){return new pe}))}},{key:"getService",value:function(e,t){if(!this._instances[e]){var n=t();this._instances[e]=n}return this._instances[e]}}],[{key:"getInstance",value:function(){return null==this._context&&(this._context=new e),this._context}}]),e}(),Ge=function(){function e(t,n){Object(o["a"])(this,e),this.type=t,this.id=n}return Object(c["a"])(e,[{key:"isGroup",value:function(){return this.type==e.GROUP}},{key:"isSubgroup",value:function(){return this.type==e.SUBGROUP}},{key:"isEmployee",value:function(){return this.type==e.EMPLOYEE}}]),e}();Ge.GROUP="GROUP",Ge.SUBGROUP="SUBGROUP",Ge.EMPLOYEE="EMPLOYEE";var ze=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.call(this),e.logger=x.getLogger("components.WorkShiftTable"),e.actionService=Le.getInstance().getActionService(),e}return Object(c["a"])(n,[{key:"increment",value:function(){var e=this;this.$store.commit("increment"),this.logger.info((function(){return"Store, increment: ".concat(e.$store.state.count)}))}},{key:"handleShift",value:function(e,t,n){this.logger.info((function(){return"New shift, employee ".concat(e,", day ").concat(t,", value=").concat(n)})),this.$emit("update-shift",e,t,n)}},{key:"getShift",value:function(e,t){return this.context.getShift(e,t,Le.getInstance().getActionService().getDefaultLabel())}},{key:"getEmployeeErrors",value:function(e,t){return this.inlineValidation?Le.getInstance().getShiftValidationService().getEmployeeErrors(e,t,this.context):[]}},{key:"hasEmployeeErrors",value:function(e,t){return this.getEmployeeErrors(e,t).length>0}},{key:"getGroupErrors",value:function(e,t){return this.inlineValidation?Le.getInstance().getShiftValidationService().getGroupErrors(e,t,this.context):[]}},{key:"hasGroupErrors",value:function(e,t){return this.getGroupErrors(e,t).length>0}},{key:"getSubgroupErrors",value:function(e,t){return this.inlineValidation?Le.getInstance().getShiftValidationService().getSubgroupErrors(e,t,this.context):[]}},{key:"hasSubgroupErrors",value:function(e,t){return this.getSubgroupErrors(e,t).length>0}},{key:"getCarsErrors",value:function(e,t){return this.inlineValidation?Le.getInstance().getShiftValidationService().getCarsErrors(t,e,this.context):[]}},{key:"hasCarsErrors",value:function(e,t){return this.getCarsErrors(e,t).length>0}},{key:"employees",value:function(){return this.context.sortedEmployees()}},{key:"tableElements",value:function(){var e=this;return this.context.sortedEmployees().map((function(t){var n=[],r=e.context.getGroupByEmployee(t),i=e.context.getSubgroupByEmployee(t);return e.isStartOfGroup(t)&&r&&n.push(new Ge(Ge.GROUP,r.id)),e.isStartOfSubgroup(t)&&i&&n.push(new Ge(Ge.SUBGROUP,i.id)),n.push(new Ge(Ge.EMPLOYEE,t)),n})).flatMap((function(e){return e}))}},{key:"formatHeaderDate",value:function(e){return Le.getInstance().getDateService().formatShort(e)}},{key:"getDayOfWeekLabel",value:function(e){var t=Le.getInstance().getDateService();return t.getDayOfWeekLabel(t.getDayOfWeek(e))}},{key:"days",value:function(){return Le.getInstance().getDateService().range(this.rangeStart(),this.rangeEnd()).length}},{key:"day",value:function(e){var t=Le.getInstance().getDateService().range(this.rangeStart(),this.rangeEnd())[e-1];return t}},{key:"rangeStart",value:function(){return Le.getInstance().getWorkShiftService().rangeStart(this.context.date)}},{key:"rangeEnd",value:function(){return Le.getInstance().getWorkShiftService().rangeEnd(this.context.date)}},{key:"isEndOfWeek",value:function(e){return Le.getInstance().getDateService().isEndOfWeek(e)}},{key:"isStartOfSubgroup",value:function(e){var t=this.employees(),n=t.findIndex((function(t){return t==e}));if(0==n)return!0;var r=t[n-1],i=this.context.getEmployee(e),a=this.context.getEmployee(r);return i.subgroupId!=a.subgroupId}},{key:"isStartOfGroup",value:function(e){var t=this.employees(),n=t.findIndex((function(t){return t==e}));if(0==n)return!0;var r=t[n-1],i=this.context.getGroupByEmployee(e),a=this.context.getGroupByEmployee(r);return(null===i||void 0===i?void 0:i.id)!=(null===a||void 0===a?void 0:a.id)}},{key:"getSubgroupName",value:function(e){var t=this.context.getSubgroupById(e);return t?t.name:""}},{key:"getGroupName",value:function(e){var t=this.context.getGroupById(e);return t?t.name:""}},{key:"getUsedCars",value:function(e,t){var n=Le.getInstance().getWorkShiftService(),r=n.countByEmployeesDatesAction(this.employees(),[e],t,this.context);return n.countByEmployeesDatesAction(this.employees(),[e],t,this.context),r}},{key:"getTotCars",value:function(){return this.context.availableCars.total}},{key:"morningAction",value:function(){return D.MORNING}},{key:"afternoonAction",value:function(){return D.AFTERNOON}},{key:"availableStates",value:function(){return Le.getInstance().getActionService().getAllLabels()}}]),n}(f["c"]);Object(l["a"])([Object(f["b"])()],ze.prototype,"context",void 0),Object(l["a"])([Object(f["b"])()],ze.prototype,"inlineValidation",void 0),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"getShift",null),Object(l["a"])([J("WorkShiftTable.cached"),H("WorkShiftTable.getEmployeeErrors",(function(e){return e[0]+"_"+e[1].toISOString()}),(new M).ttl(500).maxSize(2e3).build()),J("WorkShiftTable.raw")],ze.prototype,"getEmployeeErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"hasEmployeeErrors",null),Object(l["a"])([J("WorkShiftTable.cached"),H("WorkShiftTable.getGroupErrors",(function(e){return e[0]+"_"+e[1].toISOString()}),(new M).ttl(500).maxSize(2e3).build()),J("WorkShiftTable.raw")],ze.prototype,"getGroupErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"hasGroupErrors",null),Object(l["a"])([J("WorkShiftTable.cached"),H("WorkShiftTable.getSubgroupErrors",(function(e){return e[0]+"_"+e[1].toISOString()}),(new M).ttl(500).maxSize(2e3).build()),J("WorkShiftTable.raw")],ze.prototype,"getSubgroupErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"hasSubgroupErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"getCarsErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"hasCarsErrors",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"employees",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"tableElements",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"formatHeaderDate",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"getDayOfWeekLabel",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"days",null),Object(l["a"])([H("WorkShiftTable.day",(function(e){return e[0]}),R.init(40,1e3)),J("WorkShiftTable")],ze.prototype,"day",null),Object(l["a"])([H("WorkShiftTable.rangeStart",(function(e){return""})),J("WorkShiftTable")],ze.prototype,"rangeStart",null),Object(l["a"])([H("WorkShiftTable.rangeEnd",(function(e){return""})),J("WorkShiftTable")],ze.prototype,"rangeEnd",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"isEndOfWeek",null),Object(l["a"])([H("WorkShiftTable.isStartOfSubgroup",(function(e){return e[0]})),J("WorkShiftTable")],ze.prototype,"isStartOfSubgroup",null),Object(l["a"])([H("WorkShiftTable.isStartOfGroup",(function(e){return e[0]})),J("WorkShiftTable")],ze.prototype,"isStartOfGroup",null),Object(l["a"])([J("WorkShiftTable")],ze.prototype,"getUsedCars",null),ze=Object(l["a"])([Object(f["a"])({components:{WorkShiftInput:I}})],ze);var Ye=ze,Ue=Ye,Be=(n("aa03"),n("a523")),Fe=n("0fd9"),Pe=n("1f4f"),$e=n("3a2f9"),Je=Object(k["a"])(Ue,h,v,!1,null,"2227b553",null),He=Je.exports;b()(Je,{VContainer:Be["a"],VRow:Fe["a"],VSimpleTable:Pe["a"],VTooltip:$e["a"]});var Ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-col",{attrs:{md:"8"}},[n("v-row",{attrs:{justify:"end"}},[n("v-switch",{attrs:{label:"Validazione attiva"},on:{change:e.handleValidation},model:{value:e.validate,callback:function(t){e.validate=t},expression:"validate"}}),n("v-btn",{staticClass:"ma-2",attrs:{color:"primary",dark:""},on:{click:e.handleExportJson}},[e._v(" Save "),n("v-icon",{attrs:{dark:"",right:""}},[e._v("mdi-content-save")])],1),n("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[n("v-btn",e._g({staticClass:"ma-2",attrs:{color:"primary",dark:""}},r),[e._v(" Open "),n("v-icon",{attrs:{dark:"",right:""}},[e._v("mdi-file")])],1)]}}])},[n("v-file-input",{attrs:{label:"Import"},on:{change:e.handleImportJson}})],1),n("v-btn",{staticClass:"ma-2",attrs:{color:"purple",dark:""},on:{click:e.handleExportExcel}},[e._v(" Print "),n("v-icon",{attrs:{dark:"",right:""}},[e._v("mdi-file-excel")])],1),n("v-dialog",{attrs:{persistent:"","max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,i=t.attrs;return[n("v-btn",e._g(e._b({staticClass:"ma-2",attrs:{color:"red",dark:""}},"v-btn",i,!1),r),[e._v(" Delete "),n("v-icon",{attrs:{dark:"",right:""}},[e._v("mdi-delete")])],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[e._v("Confirm deletion?")])]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.deleteDialog=!1}}},[e._v("Cancel")]),n("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.deleteDialog=!1,e.handleClearData()}}},[e._v("Confirm")])],1)],1)],1),n("v-btn",{staticClass:"ma-2",attrs:{color:"purple",dark:""},on:{click:e.handleOptimize}},[e._v(" Optimize "),n("v-icon",{attrs:{dark:"",right:""}},[e._v("mdi-nuke")])],1)],1)],1)},qe=[],Ke=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.logger=x.getLogger("WorkShiftActions"),e.validate=!0,e.deleteDialog=!1,e}return Object(c["a"])(n,[{key:"handleValidation",value:function(){var e=this;this.logger.info((function(){return"validation: ".concat(e.validate)})),this.$emit("update-validation",this.validate)}},{key:"handleExportJson",value:function(){this.$emit("export-json")}},{key:"handleImportJson",value:function(e){this.$emit("import-json",e)}},{key:"handleExportExcel",value:function(){this.$emit("export-excel")}},{key:"handleClearData",value:function(){this.$emit("clear-data")}},{key:"handleOptimize",value:function(){this.$emit("optimize")}}]),n}(f["c"]);Ke=Object(l["a"])([Object(f["a"])({})],Ke);var Qe=Ke,Xe=Qe,et=n("8336"),tt=n("b0af"),nt=n("99d9"),rt=n("62ad"),it=n("169a"),at=n("23a7"),ot=n("132d"),ct=n("2fa4"),st=n("b73d"),ut=Object(k["a"])(Xe,Ze,qe,!1,null,null,null),lt=ut.exports;b()(ut,{VBtn:et["a"],VCard:tt["a"],VCardActions:nt["a"],VCardTitle:nt["c"],VCol:rt["a"],VDialog:it["a"],VFileInput:at["a"],VIcon:ot["a"],VMenu:_["a"],VRow:Fe["a"],VSpacer:ct["a"],VSwitch:st["a"]});var ft=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"290",persistent:""},model:{value:e.hasErrors,callback:function(t){e.hasErrors=t},expression:"hasErrors"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[e._v(e._s(e.title))]),n("v-card-text",[e._v(" "+e._s(e.message)+" ")]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(t){return t.stopPropagation(),e.acceptMessage()}}},[e._v("Close")])],1)],1)],1)},ht=[],vt=x.getLogger("components.ErrorDialog"),dt=r["default"].extend({name:"error-dialog",data:function(){return{notifications:Le.getInstance().getErrorNotifications()}},computed:{hasErrors:{set:function(e){vt.debug((function(){return"Set hasErrors: ".concat(e)}))},get:function(){var e=this.notifications.has();return vt.debug((function(){return"hasErrors: ".concat(e)})),this.notifications.has()}},title:function(){if(this.notifications.has()){var e=this.notifications.get().title;return e}return""},message:function(){if(this.notifications.has()){var e=this.notifications.get(),t=e.message;return e.wsError&&e.wsError.message&&(t+=" - "+e.wsError.message),t}return""}},methods:{acceptMessage:function(){vt.info((function(){return"Message accepted."})),this.notifications.pop()}},watch:{notifications:{handler:function(e){vt.info((function(){return"Remaining notifications ".concat(e.count())}))},deep:!0}}}),gt=dt,pt=Object(k["a"])(gt,ft,ht,!1,null,"748165b4",null),yt=pt.exports;b()(pt,{VBtn:et["a"],VCard:tt["a"],VCardActions:nt["a"],VCardText:nt["b"],VCardTitle:nt["c"],VDialog:it["a"],VSpacer:ct["a"]});var mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-overlay",{attrs:{value:e.dialog}},[n("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",{attrs:{color:"primary",dark:""}},[n("v-card-text",[e._v("Processing "),n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1)],1)},kt=[],St=x.getLogger("components.LoaderDialog"),bt=r["default"].extend({name:"error-dialog",data:function(){return{pending:0}},computed:{dialog:function(){return this.pending>0}},mounted:function(){var e=this;he.$on("ASYNC_ACTION_START",(function(t){e.pending++,St.info("async action started, pending ".concat(e.pending,": ").concat(t))})),he.$on("ASYNC_ACTION_END",(function(t){e.pending--,St.info("async action ended, pending ".concat(e.pending,": ").concat(t))}))}}),Ot=bt,Et=n("a797"),At=n("8e36"),_t=Object(k["a"])(Ot,mt,kt,!1,null,"7f2473eb",null),wt=_t.exports;b()(_t,{VCard:tt["a"],VCardText:nt["b"],VDialog:it["a"],VOverlay:Et["a"],VProgressLinear:At["a"]});var It=function(){function e(){Object(o["a"])(this,e),this._total=0}return Object(c["a"])(e,[{key:"total",set:function(e){this._total=e},get:function(){return this._total}}]),e}(),Dt=function(){function e(t,n,r){Object(o["a"])(this,e),this._employeeId=0,this._date=new Date,this._value="",this.employeeId=t,this.date=n,this.value=r}return Object(c["a"])(e,[{key:"clone",value:function(){return new e(this.employeeId,this.date,this.value)}},{key:"employeeId",get:function(){return this._employeeId},set:function(e){this._employeeId=e}},{key:"date",get:function(){return this._date},set:function(e){this._date=e}},{key:"value",get:function(){return this._value},set:function(e){this._value=e}}]),e}(),Nt=function(){function e(){Object(o["a"])(this,e)}return Object(c["a"])(e,null,[{key:"delete",value:function(e,t){for(var n=0;n<e.length;n++)t(e[n])&&(e.splice(n,1),n--)}}]),e}(),Wt=function(){function e(){Object(o["a"])(this,e),this._date=new Date,this._employees=new Map,this._groups=new Map,this._subgroups=new Map,this._availableCars=new It,this._workShifts=new Array,this._workShiftsMap=new Map}return Object(c["a"])(e,[{key:"getEmployee",value:function(e){if(this.employees.has(e))return this.employees.get(e);throw new Error("Employee "+e+" unknown.")}},{key:"sortedEmployees",value:function(){var e=this,t=Array.from(this.employees.values());return t.sort((function(t,n){var r=t.subgroupId,i=n.subgroupId;if(!r)return-1;if(!i)return 1;if(r!=i)return r-i;var a=e.subgroups.get(r),o=e.subgroups.get(i),c=0;a&&(c=a.parent);var s=0;return o&&(s=o.parent),c!=s?c-s:t.id-n.id})),t.map((function(e){return e.id}))}},{key:"sortedGroups",value:function(){return Array.from(this.groups.values()).sort((function(e,t){return e.id-t.id})).map((function(e){return e.id}))}},{key:"sortedSubgroups",value:function(){return Array.from(this.subgroups.values()).sort((function(e,t){return e.id-t.id})).map((function(e){return e.id}))}},{key:"getSubgroupByEmployee",value:function(e){var t=this.getEmployee(e).subgroupId;if(t)return this.getSubgroupById(t)}},{key:"getSubgroupById",value:function(e){return this.subgroups.get(e)}},{key:"getGroupByEmployee",value:function(e){var t=this.getSubgroupByEmployee(e);if(t&&t.parent)return this.groups.get(t.parent)}},{key:"getGroupById",value:function(e){return this.groups.get(e)}},{key:"setShift",value:function(e,t,n){var r=Le.getInstance().getDateService();Nt.delete(this.workShifts,(function(n){return n.employeeId==e&&r.format(n.date)==r.format(t)})),this.workShifts.push(new Dt(e,t,n)),this.setShiftMap(e,t,n)}},{key:"setShiftMap",value:function(e,t,n){var r,i=Le.getInstance().getDateService(),a=this._workShiftsMap;a.has(e)||a.set(e,new Map),null===(r=a.get(e))||void 0===r||r.set(i.format(t),n)}},{key:"getShift",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Le.getInstance().getActionService().getDefaultLabel();this.workShifts.length;var i=Le.getInstance().getDateService(),a=null===(n=this._workShiftsMap.get(e))||void 0===n?void 0:n.get(i.format(t));return a||r}},{key:"deleteShifts",value:function(){var e=this,t=Le.getInstance().getWorkShiftService().rangeStart(this.date),n=Le.getInstance().getWorkShiftService().rangeEnd(this.date);this.workShifts=this.workShifts.filter((function(e){return e.date<t||e.date>n})),this._workShiftsMap=new Map,this.workShifts.forEach((function(t){return e.setShiftMap(t.employeeId,t.date,t.value)}))}},{key:"date",set:function(e){this._date=e},get:function(){return this._date}},{key:"employees",set:function(e){this._employees=e},get:function(){return this._employees}},{key:"availableCars",set:function(e){this._availableCars=e},get:function(){return this._availableCars}},{key:"workShifts",set:function(e){this._workShifts=e},get:function(){return this._workShifts}},{key:"groups",set:function(e){this._groups=e},get:function(){return this._groups}},{key:"subgroups",set:function(e){this._subgroups=e},get:function(){return this._subgroups}}]),e}(),jt=function(){function e(){Object(o["a"])(this,e),this._id=0,this._name="",this._subgroupId=null,this.totWeekShifts=0,this.maxWeekMornings=0,this.maxWeekAfternoons=0}return Object(c["a"])(e,[{key:"clone",value:function(){var t=new e;return t.id=this.id,t.name=this.name,t.subgroupId=this.subgroupId,t.totWeekShifts=this.totWeekShifts,t.maxWeekMornings=this.maxWeekMornings,t.maxWeekAfternoons=this.maxWeekAfternoons,t}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"subgroupId",set:function(e){this._subgroupId=e},get:function(){return this._subgroupId}}]),e}(),Ct=function(){function e(){Object(o["a"])(this,e),this._id=0,this._name="",this._constraints=new Array}return Object(c["a"])(e,[{key:"clone",value:function(){return this.doClone(new e)}},{key:"doClone",value:function(e){return e.id=this.id,e.name=this.name,e.constraints=this.constraints.map((function(e){return e.clone()})),e}},{key:"toString",value:function(){return"id ".concat(this.id," name ").concat(this.name," constraints ").concat(this.constraints)}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"constraints",set:function(e){this._constraints=e},get:function(){return this._constraints}}]),e}(),xt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.call(this)}return Object(c["a"])(n,[{key:"clone",value:function(){var e=Object(q["a"])(Object(K["a"])(n.prototype),"doClone",this).call(this,new n);return e.parent=this.parent,e}},{key:"parent",set:function(e){this._parent=e},get:function(){if(void 0===this._parent)throw Error("Missing parent for ".concat(this));return this._parent}}]),n}(Ct),Tt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-col",{attrs:{md:"2"}},[n("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[n("v-text-field",e._g({attrs:{label:"Mese di riferimento",readonly:"",width:"30"},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}},r))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[n("v-date-picker",{attrs:{type:"month"},on:{input:function(t){e.menu=!1},change:e.update},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}})],1)],1)},Vt=[],Rt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(o["a"])(this,n),e=t.apply(this,arguments),e.logger=x.getLogger("components.MonthPicker"),e.currentValue="",e.menu=!1,e}return Object(c["a"])(n,[{key:"update",value:function(){var e=this;this.logger.info((function(){return"Updated month: ".concat(e.currentValue)})),this.$emit("update-date",this.currentValue+"-01")}},{key:"model",get:function(){return""==this.currentValue&&(this.currentValue=this.value.toUTCString().substring(0,10)),this.currentValue},set:function(e){this.currentValue=e}}]),n}(f["c"]);Object(l["a"])([Object(f["b"])()],Rt.prototype,"value",void 0),Rt=Object(l["a"])([f["a"]],Rt);var Mt=Rt,Lt=Mt,Gt=n("2e4b"),zt=n("8654"),Yt=Object(k["a"])(Lt,Tt,Vt,!1,null,"970d364a",null),Ut=Yt.exports;b()(Yt,{VCol:rt["a"],VDatePicker:Gt["a"],VMenu:_["a"],VTextField:zt["a"]});n("b64b"),n("07ac");var Bt,Ft=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.actionService=Le.getInstance().getActionService()}return Object(c["a"])(e,[{key:"deserializeContext",value:function(e){var t=this,n=new Wt;return n.date=this.dateValue(e,"date"),this.values(e,"employees").map((function(e){return t.deserializeEmployee(e)})).forEach((function(e){return n.employees.set(e.id,e)})),this.values(e,"groups").map((function(e){return t.deserializeGroup(e)})).forEach((function(e){return n.groups.set(e.id,e)})),this.values(e,"subgroups").map((function(e){return t.deserializeSubgroup(e)})).forEach((function(e){return n.subgroups.set(e.id,e)})),this.values(e,"shifts").map((function(e){return t.deserializeShift(e)})).forEach((function(e){n.setShift(e.employeeId,e.date,e.value)})),n.availableCars.total=this.numberValue(e,"availableCars"),n}},{key:"deserializeEmployee",value:function(e){var t=new jt;return t.id=this.numberValue(e,"id"),t.name=this.stringValue(e,"name"),t.subgroupId=this.numberValue(e,"subgroupId"),t.totWeekShifts=this.numberValue(e,"totWeekShifts"),t.maxWeekMornings=this.numberValue(e,"maxWeekMornings"),t.maxWeekAfternoons=this.numberValue(e,"maxWeekAfternoons"),t}},{key:"deserializeGroup",value:function(e){var t=this,n=new Ct;return n.id=this.numberValue(e,"id"),n.name=this.stringValue(e,"name"),this.values(e,"constraints").map((function(e){return t.deserializeWeekConstraint(e)})).forEach((function(e){return n.constraints.push(e)})),n}},{key:"deserializeSubgroup",value:function(e){var t=this,n=new xt;return n.id=this.numberValue(e,"id"),n.name=this.stringValue(e,"name"),n.parent=this.numberValue(e,"groupId"),this.values(e,"constraints").map((function(e){return t.deserializeWeekConstraint(e)})).forEach((function(e){return n.constraints.push(e)})),n}},{key:"deserializeWeekConstraint",value:function(e){var t=this.dateService.getDayOfWeekFromName(this.stringValue(e,"dayOfWeek")),n=this.actionService.getActionFromName(this.stringValue(e,"action")),r=this.numberValue(e,"value");return ce.min(t,n,r)}},{key:"deserializeShift",value:function(e){var t=this.numberValue(e,"employeeId"),n=this.dateValue(e,"date"),r=this.stringValue(e,"value");return new Dt(t,n,r)}},{key:"dateValue",value:function(e,t){var n=this.stringValue(e,t);return this.dateService.parse(n)}},{key:"numberValue",value:function(e,t){var n=this.value(e,t);return n}},{key:"stringValue",value:function(e,t){var n=this.value(e,t);return n}},{key:"values",value:function(e,t){return this.value(e,t)}},{key:"value",value:function(e,t){for(var n=Object.keys(e),r=-1,i=0;i<n.length;i++)n[i]==t&&(r=i);return Object.values(e)[r]}}]),e}(),Pt=function(){function e(){Object(o["a"])(this,e),this.dateService=Le.getInstance().getDateService(),this.actionService=Le.getInstance().getActionService()}return Object(c["a"])(e,[{key:"serializeContext",value:function(e,t,n){var r=this,i={date:this.dateService.format(e.date),employees:Array.from(e.employees.values()).map((function(e){return r.serializeEmployee(e)})),groups:Array.from(e.groups.values()).map((function(e){return r.serializeGroup(e)})),subgroups:Array.from(e.subgroups.values()).map((function(e){return r.serializeSubgroup(e)})),availableCars:e.availableCars.total,shifts:Array.from(e.workShifts.values()).map((function(e){return r.serializeShift(e)}))};return i}},{key:"serializeEmployee",value:function(e){return{id:e.id,name:e.name,subgroupId:e.subgroupId,totWeekShifts:e.totWeekShifts,maxWeekMornings:e.maxWeekMornings,maxWeekAfternoons:e.maxWeekAfternoons}}},{key:"serializeGroup",value:function(e){var t=this;return{id:e.id,name:e.name,constraints:e.constraints.map((function(e){return t.serializeWeekConstraint(e)}))}}},{key:"serializeSubgroup",value:function(e){var t=this;return{id:e.id,name:e.name,groupId:e.parent,constraints:e.constraints.map((function(e){return t.serializeWeekConstraint(e)}))}}},{key:"serializeWeekConstraint",value:function(e){return{dayOfWeek:this.dateService.getDayOfWeekName(e.dayOfWeek),type:e.type,action:this.actionService.getActionName(e.action),value:e.value}}},{key:"serializeShift",value:function(e){return{employeeId:e.employeeId,date:this.dateService.format(e.date),value:e.value}}}]),e}(),$t=n("21a6"),Jt=Bt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(o["a"])(this,n),e=t.call(this),e.logger=x.getLogger("App"),e.inlineValidation=!0;var r=Le.getInstance().getDateService(),i=new Wt;return e.context=i,i.date=r.parse(r.format(new Date)),Bt.group(i,1,"Macro1",Bt.weekConstraint(0,1,1,1)),Bt.group(i,2,"Macro2",Bt.weekConstraint(0,1,1,1)),Bt.group(i,3,"Macro3",Bt.weekConstraint(0,0,0,0)),Bt.subgroup(i,1,"Mogliano",1,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,2,"Preganziol",1,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,3,"Casale / Roncade",1,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,4,"S.Bona",2,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,5,"c.citt",2,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,6,"S.Zeno",2,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,7,"S.Biagio Silea",2,Bt.weekConstraint(1,0,0,0)),Bt.subgroup(i,8,"CP",3,Bt.weekConstraint(1,0,0,0)),Bt.employee(i,1,"ALBORE P. SANDRO",1,5,5,2),Bt.employee(i,2,"CHINELLATO MONIA",1,5,5,2),Bt.employee(i,3,"GIACOMIN BARBARA",1,5,5,0),Bt.employee(i,4,"RIGO FRANCESCA",2,5,5,2),Bt.employee(i,5,"BARBATO GIUSEPPE",2,5,5,2),Bt.employee(i,6,"VIALE MARTA",2,5,5,2),Bt.employee(i,7,"COSTANTINI RENZO",3,5,5,2),Bt.employee(i,8,"BERTON ELISABETTA",3,4,4,2),Bt.employee(i,9,"TOZZATO MARTINA",3,5,5,2),Bt.employee(i,10,"BERALDO SILVIA",4,5,5,2),Bt.employee(i,11,"CITTON MARZIA",4,5,5,2),Bt.employee(i,12,"CERON CESARE",4,5,5,2),Bt.employee(i,13,"VANIN STEFANIA",5,5,5,2),Bt.employee(i,14,"SERAFIN SERENA",5,5,5,2),Bt.employee(i,15,"MAREN FABIO",5,5,5,2),Bt.employee(i,16,"TONON CHRISTIAN",6,5,5,2),Bt.employee(i,17,"CARPIN ANNALISA",6,5,5,2),Bt.employee(i,18,"SPIGARIOL PAOLO",7,5,5,2),Bt.employee(i,19,"VIANELLO MARTA",7,5,5,2),Bt.employee(i,20,"BOT CLAUDIA",7,4,4,2),Bt.employee(i,21,"BEZZI SILVIA",8,5,5,2),Bt.employee(i,22,"BRUNELLO VANIA",8,5,5,2),i.availableCars.total=10,e}return Object(c["a"])(n,[{key:"handleExportExcel",value:function(){var e=this;this.logger.info((function(){return"Excel export"})),(new de).url("/workshifts-rest/export").responseType("blob").post().headerJson().call((new Pt).serializeContext(this.context,this.rangeStart(),this.rangeEnd())).then((function(t){var n=new Blob([t.data]),r=Le.getInstance().getDateService().formatYYYYMM(e.context.date),i="Turni lavorativi ".concat(r,".xlsx");e.logger.info((function(){return"Save file as ".concat(i)})),Object($t["saveAs"])(n,i)})).catch((function(e){Le.getInstance().getErrorNotifications().add(new ge("Error","Error exporting calendar"))}))}},{key:"handleValidation",value:function(e){this.logger.info((function(){return"Validation ".concat(e)})),this.inlineValidation=e}},{key:"handleExportJson",value:function(){this.logger.info((function(){return"Json export"}));var e=(new Pt).serializeContext(this.context,this.rangeStart(),this.rangeEnd()),t=JSON.stringify(e),n=new Blob([t],{type:"application/json"});Object($t["saveAs"])(n,"content.json")}},{key:"handleImportJson",value:function(e){var t=this;if(this.logger.info((function(){return"importJson"})),!e)return this.logger.info((function(){return"No selected file"})),null;var n=new FileReader;n.readAsText(e),n.onload=function(){var e=n.result;if(t.logger.info((function(){return"File read completed"})),null!=e){var r=e,i=JSON.parse(r);t.logger.info((function(){return"File is a valid json"})),t.context=(new Ft).deserializeContext(i),t.logger.info((function(){return"File is imported"}))}}}},{key:"handleUpdateDate",value:function(e){this.logger.info((function(){return"Update date: ".concat(e)}));var t=Le.getInstance().getDateService();this.context.date=t.parse(e),this.context.workShifts.length}},{key:"handleClearData",value:function(){this.context.deleteShifts()}},{key:"handleOptimize",value:function(){this.logger.info((function(){return"Optimize"})),Le.getInstance().getOptimizeShiftsService().optimize(this.context)}},{key:"days",value:function(){return Le.getInstance().getDateService().range(this.rangeStart(),this.rangeEnd()).length}},{key:"day",value:function(e){var t=Le.getInstance().getDateService().range(this.rangeStart(),this.rangeEnd())[e-1];return t}},{key:"rangeStart",value:function(){return Le.getInstance().getWorkShiftService().rangeStart(this.context.date)}},{key:"rangeEnd",value:function(){return Le.getInstance().getWorkShiftService().rangeEnd(this.context.date)}},{key:"handleShift",value:function(e,t,n){this.logger.info((function(){return"New shift, employee ".concat(e,", day ").concat(t,", value=").concat(n)})),this.context.setShift(e,t,n)}}],[{key:"employee",value:function(e,t,n,r,i,a,o){var c=new jt;return c.id=t,c.name=n,c.totWeekShifts=i,c.maxWeekMornings=a,c.maxWeekAfternoons=o,c.subgroupId=r,e.employees.set(t,c),c}},{key:"group",value:function(e,t,n,r){var i=new Ct;return i.id=t,i.name=n,i.constraints=r.map((function(e){return e.clone()})),e.groups.set(t,i),i}},{key:"subgroup",value:function(e,t,n,r,i){var a=new xt;return a.id=t,a.name=n,a.parent=r,a.constraints=i.map((function(e){return e.clone()})),e.subgroups.set(t,a),a}},{key:"weekConstraint",value:function(e,t,n,r){var i=new Array,a=Le.getInstance().getDateService();return a.getWeekdays().forEach((function(n){i.push(ce.min(n,D.MORNING,e)),i.push(ce.min(n,D.AFTERNOON,t))})),a.getWeekendDays().forEach((function(e){i.push(ce.min(e,D.MORNING,n)),i.push(ce.min(e,D.AFTERNOON,r))})),i}}]),n}(f["c"]);Jt=Bt=Object(l["a"])([Object(f["a"])({components:{WorkShiftTable:He,MonthPicker:Ut,WorkShiftActions:lt,ErrorDialog:yt,LoaderDialog:wt}})],Jt);var Ht=Jt,Zt=Ht,qt=(n("5c0b"),n("7496")),Kt=n("40dc"),Qt=n("a75b"),Xt=Object(k["a"])(Zt,i,a,!1,null,null,null),en=Xt.exports;b()(Xt,{VApp:qt["a"],VAppBar:Kt["a"],VContent:Qt["a"],VRow:Fe["a"]});var tn=n("2f62");r["default"].use(tn["a"]);var nn=new tn["a"].Store({state:{count:0,fromDate:(new Date).toISOString().slice(0,10),toDate:(new Date).toISOString().slice(0,10)},mutations:{increment:function(e){e.count++},updateFromDate:function(e,t){e.fromDate=t},updateToDate:function(e,t){e.toDate=t}},actions:{},modules:{}}),rn=n("ce5b"),an=n.n(rn),on=(n("bf40"),n("f309"));r["default"].use(on["a"]);var cn=new on["a"]({});r["default"].use(an.a),r["default"].config.productionTip=!1,new r["default"]({store:nn,vuetify:cn,render:function(e){return e(en)}}).$mount("#app")}});
//# sourceMappingURL=app.71bb5e14.js.map